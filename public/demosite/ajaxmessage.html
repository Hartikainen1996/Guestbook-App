<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>New message</title>
    <link href="css/style.css" rel="stylesheet" type="text/css" />
  </head>

  <body>
    <div id="wrapper">
      <div id="branding">
        <h1 class="logo"><a href="/">My Guestbook App</a></h1>
        <ul class="topNav">
          <li><a href="/">HOME</a></li>
          <li><a href="/newmessage">MESSAGE</a></li>
          <li>
            <a href="/ajaxmessage" class="topNavAct">AJAX</a>
          </li>
          <li><a href="/guestbook" class="topNavLast">GUESTBOOK</a></li>
        </ul>
        <br class="clear" />
      </div>
      <div class="container">
        <form method="POST" action="/ajaxmessage">
          <h1>Leave a message in the guestbook:</h1>
          <br />
          <label>Name</label><br />
          <input type="text" id="Name" required /><br />

          <label>Country</label><br />
          <input type="text" id="Country" required /><br />

          <label>Message</label><br />
          <textarea
            id="Message"
            placeholder="Write something, please..."
            style="height:200px"
            required
          ></textarea
          ><br /><br />

          <button type="button" onclick="ajaxPyyntö()">Submit</button>
        </form>
      </div>
      <div id="status"></div>
    </div>
    <div id="footerContainer">
      <p>
        <label
          >Made by
          <a href="https://github.com/Hartikainen1996"
            >Eemil Hartikainen</a
          ></label
        >
      </p>
    </div>
    <script>
      function ajaxPyyntö() {
        // Get info from the text fields
        var name = document.getElementById("Name");
        var country = document.getElementById("Country");
        var message = document.getElementById("Message");

        // Luodaan AJAX olio joka palauttaa vastauksensa status-kenttään
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            document.getElementById("status").innerHTML = this.responseText;
          }
        };

        // Lähetetään AJAX pyyntö, tyyppiä POST osoitteeseen /ajaxmessage
        xmlhttp.open("POST", "/ajaxmessage", true);
        xmlhttp.setRequestHeader("Content-type", "application/json");
        // Kootaan kenttien tiedot data-muuttujaan
        var data = {
          Name: name.value,
          Country: country.value,
          Message: message.value,
          Date: new Date()
        };
        // Lähetetään data-muuttuja merkkijonona palvelimelle
        xmlhttp.send(JSON.stringify(data));
        name.value = " ";
        country.value = " ";
        message.value = " ";
      }
    </script>
  </body>
</html>
